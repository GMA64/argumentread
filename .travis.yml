# Travis CI for building ArgumentReader
# --------------------------------------------

language: csharp
solution: ArgumentsExtended.sln
mono: none
dotnet: 3.1.301

addons:
  apt:
    packages:
      - zip

install:
  - dotnet restore

script:
  - dotnet build --configuration Release
  - dotnet test 
  - mkdir ./release
  - dotnet publish -c Release -o ./release --self-contained false
  - ls -l ./release

before_deploy:
  - zip -r ./release.zip ./release
  - export TRAVIS_TAG="latest"
  - git tag $TAVIS_TAG

deploy:
  provider: releases
  overwrite: true
  api_key: $GITHUB_TOKEN 
  file: "release.zip"
  file:
    - ./release/ArgumentMarshalerLib.dll
    - ./release/ArgumentsLib.dll
    - ./release/BooleanMarshalerLib.dll
    - ./release/DoubleMarshalerLib.dll
    - ./release/IntegerMarshalerLib.dll
    - ./release/StringMarshalerLib.dll
  skip_cleanup: true
  keep_history: true
  on:
    branch: master
